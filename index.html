<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cheff's Table 2025</title>

    <!-- OpenGraph tags for social sharing -->
    <meta property="og:title" content="Cheff's Table 2025">
    <meta property="og:description" content="You're invited.">
    <meta property="og:image" content="https://cheffs-table-2025.netlify.app/images/og-image.png">
    <meta property="og:url" content="https://cheffs-table-2025.netlify.app">
    <meta property="og:type" content="website">

    <!-- Additional tags for better iMessage display -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Cheff's Table 2025">
    <meta name="twitter:description" content="You're invited.">
    <meta name="twitter:image" content="https://cheffs-table-2025.netlify.app/images/og-image.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@300&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
            line-height: 1.5;
        }

        body {
            font-family: "Josefin Sans", sans-serif;
            font-size: 25px;
            font-style: normal;
            font-weight: 300;
            line-height: normal;
            min-height: 100vh;
            overscroll-behavior: none;
            background-image: url('images/paper-texture.png');
            background-size: cover;
            background-position: center;
            background-attachment: scroll;
            z-index: -1;
        }

        img, picture, video, canvas, svg {
            display: block;
            max-width: 100%;
        }

        input, button, textarea, select {
            font: inherit;
        }

        .header {
            display: block;
            margin: 0 auto;
            max-width: 100vw;
            max-height: 60vh;
            height: auto;
            width: 100%;
            object-fit: contain;
        }

        .main {
          width: 800px;
          max-width: 100vw;
          padding: 0 20px 0 20px;
          margin: 50px auto 50px auto;
        }

        .main p {
          margin-bottom: 20px;
        }

        .team-grid {
          display: grid;
          grid-template-columns: 1fr auto;
          grid-template-rows: auto auto auto;
          margin: 40px 0;
          row-gap: 5px;
        }

        .team-grid > * {
          align-self: baseline;
        }

        .team-member {
          text-align: right;
        }

        .team-role {
          text-align: left;
          margin-left: 10px;
          font-size: 60%;
          color: rgba(0, 0, 0, 0.55);
        }

        .info-grid {
          display: grid;
          grid-template-columns: 1fr 1fr;
          margin: 40px 0;
          width: 100%;
        }

        .info-right {
          text-align: right;
        }

        .divider {
          height: 1px;
          width: 70%;
          background-color: rgba(0, 0, 0, 0.30);
          margin: 0 auto;
        }

        .menus {
          display: flex;
          flex-direction: row;
          gap: 20px;
          margin: 0 auto 40px auto;
          justify-content: center;
          padding: 20px;
          opacity: 0.9;
          filter: drop-shadow(3px 3px 0px rgba(0, 0, 0, 0.05));
        }

        .menus img {
          max-height: 40vh;
        }

        @media (max-width: 767px) {
            .menus {
              display: grid;
              grid-template-columns: 1fr 1fr;
              grid-template-rows: 1fr 1fr;
              margin: 0 20px 20px 20px;
            }

            .header {
                max-height: none;
                content: url('images/header-mobile.png');
            }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1s ease-out;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: #000;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
        }

        .default-view {
            text-align: center;
            padding: 20px 20px;
        }

        .default-view .menus img {
          max-height: 80vh;
        }

        .default-view a img:hover, .default-view a img:focus {
          transform: scale(1.03);
          -moz-transform: scale(1.03);
          -webkit-transform: scale(1.03);
          transition: transform 0.3s ease-out;
          -moz-transition: -moz-transform 0.3s ease-out;
          -webkit-transition: -webkit-transform 0.3s ease-out;
        }

        @media (max-width: 767px) {
            .default-view .menus {
              display: grid;
              grid-template-columns: 1fr;
              grid-template-rows: 1fr;
              margin: 10px;
            }
        }

        .create-form {
            margin: 50px auto;
            max-width: 600px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
        }

        .form-group input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .radio-group {
            margin: 20px 0;
        }

        .radio-option {
            margin-bottom: 10px;
        }

        button {
            background-color: #000;
            color: #fff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 18px;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }
    </style>
</head>
<body>
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner" id="spinner"></div>
  </div>

  <!-- Default View -->
  <div id="defaultView" class="view">
    <section class="default-view">
      <section class="menus">
        <div class="menu-2022">
          <a href="https://www.instagram.com/p/CdXD1A2roep/" target="_blank">
          <img src="images/2022-menu.png" alt="Cheff's Table 2022">
          </a>
        </div>
        <div class="menu-2023">
          <a href="https://www.owenwang.com/blog/we-are-what-we-eat" target="_blank">
          <img src="images/2023-menu.png" alt="Cheff's Table 2023">
          </a>
        </div>
        <div class="menu-2024">
          <a href="https://www.instagram.com/p/C6fIOF0PNhY/" target="_blank">
          <img src="images/2024-menu.png" alt="Cheff's Table 2024">
          </a>
        </div>
        <div class="menu-2025">
          <img src="images/2025-menu.png" alt="Cheff's Table 2025">
        </div>
      </section>
    </section>
  </div>

  <!-- Invite View -->
  <div id="inviteView" class="view">
    <img class="header" src="images/header-desktop.png" alt="Cheff's Table 2025">
    <section class="main">
      <p><span id="guestName">Guest</span>,</p>
      <p>
        We're pleased to invite you to Cheff's Table 2025, our 4th annual
        invite-only tasting menu.
      </p>

      <div class="team-grid">
        <div class="team-member">Owen, Jon, Richard, Tao</div>
        <div class="team-role">Cheffs</div>
        <div class="team-member">Jamie, Lyn</div>
        <div class="team-role">Service</div>
        <div class="team-member">Kevin</div>
        <div class="team-role">Videography</div>
      </div>

      <div class="divider"></div>

      <div class="info-grid">
        <div class="info-left">
          <div><span id="eventDate">Saturday, May 24</span></div>
          <div><span id="eventTime">11:00am-2:00pm</span></div>
          <div>&nbsp;</div>
          <div>Address TBA</div>
          <div>Mission District</div>
          <div>San Francisco</div>
        </div>
        <div class="info-right">
          <div>$100 to reserve</div>
          <div>Venmo @Jamie-Wong</div>
        </div>
      </div>
    </section>
    <section class="menus">
      <div class="menu-2022">
        <img src="images/2022-menu.png" alt="Cheff's Table 2022">
      </div>
      <div class="menu-2023">
        <img src="images/2023-menu.png" alt="Cheff's Table 2023">
      </div>
      <div class="menu-2024">
        <img src="images/2024-menu.png" alt="Cheff's Table 2024">
      </div>
      <div class="menu-2025">
        <img src="images/2025-menu.png" alt="Cheff's Table 2025">
      </div>
    </section>
  </div>

  <!-- Create View -->
  <div id="createView" class="view">
    <section class="main create-form">
      <form id="inviteForm">
        <div class="form-group">
          <label for="name">Guest (first name only) :</label>
          <input type="text" id="name" name="name" required>
        </div>

        <div class="radio-group">
          <label>Select a date:</label>
          <!-- Remember if you change these dates to change them below as well -->
          <div class="radio-option">
            <input type="radio" id="date1" name="dateOption" value="1" checked>
            <label for="date1">Saturday, May 24, 11:00am-2:00pm (Critics)</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="date2" name="dateOption" value="2">
            <label for="date2">Sunday, May 25, 11:00am-2:00pm (Cozy)</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="date3" name="dateOption" value="3">
            <label for="date3">Sunday, May 25, 6:00pm-9:00pm (Networky)</label>
          </div>
        </div>

        <button type="submit">Generate Invitation</button>
      </form>
    </section>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Create an array to hold all resource load promises
      const loadPromises = [];

      // Handle font loading
      const fontLoading = document.fonts.ready;
      loadPromises.push(fontLoading);

      // Handle image loading (including background images)
      const images = Array.from(document.querySelectorAll('img'));
      const imagePromises = images.map(img => {
        if (img.complete) return Promise.resolve();
        return new Promise(resolve => {
          img.onload = resolve;
          img.onerror = resolve; // Resolve even on error to avoid hanging
        });
      });
      loadPromises.push(...imagePromises);

      // Handle background image
      const bgImage = new Image();
      bgImage.src = 'images/paper-texture.png';
      const bgImagePromise = new Promise(resolve => {
        if (bgImage.complete) resolve();
        else {
          bgImage.onload = resolve;
          bgImage.onerror = resolve; // Resolve even on error to avoid hanging
        }
      });
      loadPromises.push(bgImagePromise);

      // When everything is loaded, hide the overlay
      Promise.all(loadPromises).then(() => {
        document.getElementById('spinner').style.display = 'none';

        // Small delay to ensure everything is rendered
        setTimeout(() => {
          const overlay = document.getElementById('loadingOverlay');
          overlay.classList.add('hidden');

          // Remove overlay after transition completes
          overlay.addEventListener('transitionend', function() {
            overlay.style.display = 'none';
          });
        }, 300);
      });

      // Routing logic
      function router() {
        const queryParams = new URLSearchParams(window.location.search);
        const views = {
          default: document.getElementById('defaultView'),
          invite: document.getElementById('inviteView'),
          create: document.getElementById('createView')
        };

        // Hide all views initially
        Object.values(views).forEach(view => view.classList.remove('active'));

        // Available dates array
        const seatings = [
          {
            date: "Saturday, May 24",
            time: "11:00am — 2:00pm",
          },
          {
            date: "Sunday, May 25",
            time: "11:00am — 2:00pm",
          },
          {
            date: "Sunday, May 25",
            time: "6:00pm — 9:00pm",
          }
        ];

        // Check for invite parameter
        if (queryParams.has('i')) {
          try {
            // Base64 decode the value
            const base64Value = queryParams.get('i');
            const decodedValue = atob(base64Value);

            // Split on comma
            const [name, seatingNum] = decodedValue.split(',');

            // Validate date index (1-3)
            const dateNum = parseInt(seatingNum, 10);
            if (name && dateNum >= 1 && dateNum <= 3) {
              // Update the name and date in the invite view
              document.getElementById('guestName').textContent = name;
              document.getElementById('eventDate').textContent = seatings[dateNum - 1].date;
              document.getElementById('eventTime').textContent = seatings[dateNum - 1].time;
              // Show the invite view
              views.invite.classList.add('active');
              return;
            }
          } catch (e) {
            // Error in decoding, fall back to default view
            console.error("Error decoding invitation:", e);
          }
        }

        // Check for create parameter
        if (queryParams.has('create')) {
          views.create.classList.add('active');

          // Set up form submission handling
          document.getElementById('inviteForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const name = document.getElementById('name').value.trim();
            const dateOption = document.querySelector('input[name="dateOption"]:checked').value;

            if (name) {
              // Create the encoded value
              const value = `${name},${dateOption}`;
              const encodedValue = btoa(value);

              // Redirect to the invite view
              window.location.href = `?i=${encodedValue}`;
            }
          });

          return;
        }

        // Default view if no valid parameters
        views.default.classList.add('active');
      }

      // Run the router
      router();

      // Handle browser back/forward navigation
      window.addEventListener('popstate', router);
    });
  </script>
</body>
</html>